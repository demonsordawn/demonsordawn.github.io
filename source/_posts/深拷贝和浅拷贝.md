---
title: 深拷贝和浅拷贝
tags: []
---

## 什么是深拷贝和浅拷贝
### 深拷贝是递归拷贝深层次,属性为对象时,深拷贝是新开栈,两个对象指向不同的地址
### 浅拷贝是拷贝一层,属性为对象时,浅拷贝是复制,两个对象指向同一个地址

### 深拷贝函数,考虑循环引用
```javaScript
/**
 * 深拷贝函数(支持循环引用检测)
 * @param {Object} obj - 需要拷贝的对象
 * @param {WeakMap} [hash=new WeakMap()] - 用于存储已拷贝对象的弱引用映射
 * @return {Object} 深拷贝后的对象
 */
function deepClone(obj,hash = new WeakMap()){
    //基本类型直接返回(包括null,undefined,number,string,boolean)
    if(obj === null || typeof obj !== 'object') return obj;
    //特殊对象处理 - Date类型
    if(obj instanceof Date) return new Date(obj); //通过时间戳创建新的Date对象
    if(obj instanceof RegExp) return new RegExp(obj); //复制正则表达式

    //循环引用检测,如果对象已经被拷贝过,直接返回存储的拷贝对象
    if(hash.has(obj)) return hash.get(obj);
    //创建新对象,保持与原对象相同的构造函数
    //例如:原对象是Array则创建Array,是自定义类则创建同类实例
    const cloneObj = new obj.constructor();
    //将源对象和拷贝对象的映射存入WeakMap,用于后续循环引用检测
    hash.set(obj,cloneObj);
    //遍历对象所有可枚举属性(包括原型链上的属性)
    for(let key in obj){
        //只处理对象自身的属性(不处理继承的属性)
        if(obj.hasOwnProperty(key)){
            //递归拷贝每个属性值
            cloneObj[key] = deepClone(obj[key],hash);
        }
    }
    //返回深拷贝完成的对象
    return cloneObj;
}
```